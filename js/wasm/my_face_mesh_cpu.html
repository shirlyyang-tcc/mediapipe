<!DOCTYPE html>
<html>
    <header>
        <style>
            #container {
                display: flex;
                flex-direction: row;
                /* flex-shrink: 0.5; */
            }
        </style>
        <script src="./my_face_mesh_cpu.js"></script>
    </header>
    <body>
        <div id="container">

        </div>
        <!--play source video-->
        <video 
        id="video0"  
        muted
        loop
        crossorigin="anonymous"
        src="https://webar-static.tencent-cloud.com/temp/1.mp4"></video>
        <!--get image data from video-->
        <canvas id="proxy-canvas"></canvas>
        <!--draw facemesh result-->
        <canvas id="result-canvas"></canvas>
    </body>
    <script>
        async function initDetector() {
            return new Promise((resolve, rejct) => {
                const init = new Module()
                init.then((a) => {
                    // console.log('???', a)
                    resolve(a)
                })
                console.log('init',init)
            })

        }
        
        function main(Module) {
            const video = document.querySelector('#video0')
            const proxycanvas = document.querySelector('#proxy-canvas')
            const proxycontext = proxycanvas.getContext('2d')
            
            console.log('MppGraphManager',Module.MppGraphManager)
            video.addEventListener('canplay', () => {
                const {videoWidth, videoHeight} = video
                // console.log('}}}',videoWidth, videoHeight)
                proxycanvas.style.width = videoWidth
                proxycanvas.style.height = videoHeight
                proxycanvas.width = videoWidth
                proxycanvas.height = videoHeight


                const manager = new Module.MppGraphManager()

                const draw = () => {
                    proxycontext.clearRect(0,0, videoWidth, videoHeight)
                    proxycontext.drawImage(video, 0, 0,videoWidth,videoHeight)
                    const imagedata = proxycontext.getImageData(0,0, videoWidth,videoHeight)
                    // console.log('imagedata',imagedata)
                    requestAnimationFrame(draw)
                }
                requestAnimationFrame(draw)
            })
            video.play()
            
        }
        // setTimeout(() => {
        initDetector().then(Module => {
            console.log('+++', Module)
            main(Module)

        })
        // }, 1000)
    </script>
</html>